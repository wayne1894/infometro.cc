<!DOCTYPE html>
<html lang="zh-TW">
<head>
@@include('include/head.html')
</head>
<body>
<div id="main">
  <div id="left">
    <div id="line_parent">
      <div id="logo"><img src="images/icon_128.fw.png" alt=""></div>
      <div class="line_text">所有支線：</div>
      <div id="left_line">
        <ul>
          <li v-for="(item, index) in line">
            <svg class="tool" fill="#40659b">
              @@include('include/tool.html')
            </svg>
            <i style="background-color:#FF6907"></i>
            <span>{{item.name}}</span>
          </li>
        </ul>
      </div>
      <a href="javascript:void(0)" id="new_line" class="default_a" onclick="edit_metro()">新增支線</a>
    </div>
    <div id="edit_parent">
<!--  http://semantic-ui.com/elements/icon.html-->
      <a class="left_icon" href="javascript:void(0)"><i class="setting icon"></i></a>
<!--  <a class="left_icon" href="javascript:void(0)"><i class="help circle icon"></i></a>-->
<!--  sign out-->
      <a class="left_icon" href="javascript:void(0)"><i class="power icon"></i></a>
    </div>
  </div>
  <div id="top">
    <div id="triangle_left"></div>
    <div id="top_tag_parent">
      <ul id="top_tag">
        <li v-for="(item, index) in metro">
          <i style="background-color:none"></i><span>{{item.name}}</span>
        </li>
      </ul>
    </div>
    <div id="triangle_right"></div>
  </div>
  <div id="center">
    <div id="board1">
        <div id="board_line_parent">
          <div id="board_line"><i style="background-color:#30CB68"></i><div>淡水線</div></div>
          <div id="board_edit"><i class="male icon"></i></div>
        </div>
        <div id="board_tag_name">
          <div id="tag_name">
              <i style="background-color:#30CB68;"></i>
              <div id="tag_name_info">
                  <div>社會學</div>
                  <div>資訊共25筆</div>
                  <div>建立時間：<span>2015/03/29</span></div>
              </div>
          </div>
        </div>
      <div id="board3">
        <div id="board3_header"><i class="heart orange icon"></i><span class="text">最愛連結</span>
        </div>
        <div id="board_favorites">
          <div v-for="n in 20"></div>
        </div>
        <div id="board_search">
          <div id="input_search">
              <input type="text" placeholder="Search">
              <i class="search icon"></i>
          </div>
        </div>
        <div id="board_copyright"></div>
      </div>
    </div>
    <div id="board2">
      <div id="board_enter_parent">
        <div id="board_img"><img src="images/img1.jpg"></div>
        <div id="board_enter">
          <textarea id="board_textarea" name="textarea1" placeholder="輸入資訊"></textarea>
        </div>
      </div>
      <div id="board_send_parent">
        <div id="board_tag_select">
        </div>
        <button id="board_send" class="ui mini orange button" type="submit">送出</button>
      </div>
      <div id="board_info">
        <div v-for="(item, index) in info" class="ui vertical segment clear">
          <img class="ui medium left floated image transition " src="images/square-image.png">
          <p>看見我的靈魂裡那洗拭不去的黑色污點</p>
          <span class="left">
            <i class="like icon"></i>
            <i class="trash icon"></i>
          </span>
        </div>
      </div>
    </div>
  </div>
  <div id="bottom">
    <div id="blueprint">
      <div id="blueprint_drag">
        <div v-for="(item, index) in blueprint" class="blueprint_list">
            <a class="blueprint_a" :class="check_bluprint(index)" @click="change_index_bluprint(index)"> {{item.name}}</a>
             <!-- 
              <span @click="delete_blueprint(item)">刪除</span>
              -->
        </div>
      </div>
      <a id="blueprint_new" class="default_a" @click="new_blueprint()">新增地鐵</a>
    </div>
    <div id="copyright">2017資訊地鐵站 版權所有 </div>
  </div>
  <div id="right">
    <div class="right_header_line"></div>
    <div class="right_tool">
      <div class="r_button">
        <div id="首頁" class="r_b t2"></div>
      </div>
      <div class="r_button active">
        <i class="facebook f icon"></i>
      </div>
      <div class="r_button">
        <div id="資訊" class="r_b t2"></div>
      </div>
      <div class="r_button">
        <div id="搜尋" class="r_b t2"></div>
      </div>
      <div class="r_button">
        <div id="問號" class="r_b t2"></div>
      </div>
    </div>
    <div class="right_main">
      <div v-for="n in 50">
        <br><br><br>
      </div>
    </div>
    <div class="right_line"></div>
  </div>
</div>
<script>
  var vm = new Vue({
    el: '#main',
    data: {
      blueprint : [],
      index_blueprint : 0,
      index_line : 0,
      key_metro : ""
    },firebase: function(){
      var _user = user ? user.uid : "" ;
      var _key_metro = this.key_metro.length ? this.key_metro : "N";//用N的用意是避免載入所有結點
      return {
        info: D.ref("info/"+_user+"/"+_key_metro)
      }
    },computed: {
     line : function(){//載入line
       if(this.blueprint.length==0)return false;
       return this.blueprint[this.index_blueprint].line;
     },
     metro : function(){//載入metro
       if(this.blueprint.length==0)return false; //藍圖如果不存在離開
       var _line=this.blueprint[this.index_blueprint].line
       if(_line.length==0)return false; //線如果不存在離開
       this.key_metro = _line[this.index_line].metro[0]._key; //載入時直接選取一個站點(可以是該線路的總站)
       return _line[this.index_line].metro;
     }
    },watch: {
      key_metro : function (){//載入新的info
        vm.$bindAsObject('info', D.ref("info/"+user.uid+"/"+this.key_metro));
      }
    },methods: {
      new_blueprint : function(){//新增藍圖
        新增藍圖("未命名");
      },
      delete_blueprint : function (item){//刪除藍圖
        D.ref('users/' + user.uid+"/"+item.key).remove();
      },
      change_index_bluprint : function(index){
        this.index_blueprint=index;
      },new_line : function(){
        var result = window.prompt("請輸入支線名稱", "");
        if(result){
          //this.blueprint[this.index_blueprint].line.push()
        }
      },delete_line : function(){
        
      },check_bluprint : function(index){
        if(this.index_blueprint==index){
          return "check";
        }
      }
    }
  })

  function _is_login(){
   blueprint_init("init");
   //vm.blueprint=test_json();
  }
  function test_json(){
   //http://www.jsoneditoronline.org/
   return [{"line":[{"color":"#ff6900","metro":[{"_key":"-KeY15jjQjXluUIRRJSc","name":"台北車站"},{"_key":"-KeY15jkYC4caxLdspWo","name":"關渡站"}],"name":"淡水線a1","sort":1},{"color":"#ff6900","metro":[{"_key":"-KeY15jkYC4caxLdspWp","name":"府中站"},{"_key":"-KeY15jkYC4caxLdspWq","name":"亞東醫院站"}],"name":"板南線a2","sort":2},{"color":"#ff6900","metro":[{"_key":"-KeY15jkYC4caxLdspWr","name":"府中站"},{"_key":"-KeY15jkYC4caxLdspWs","name":"亞東醫院站"}],"name":"其他線a3","sort":3}],"name":"未命名","sort":1,"key":"-KeY15jjQjXluUIRRJSb"},{"line":[{"color":"#ff6900","metro":[{"_key":"-KeYwacCNUTtXWIY8GKF","name":"台北車站"},{"_key":"-KeYwacCNUTtXWIY8GKG","name":"關渡站"}],"name":"淡水線a1","sort":1},{"color":"#ff6900","metro":[{"_key":"-KeYwacCNUTtXWIY8GKH","name":"府中站"},{"_key":"-KeYwacCNUTtXWIY8GKI","name":"亞東醫院站"}],"name":"板南線a2","sort":2},{"color":"#ff6900","metro":[{"_key":"-KeYwacCNUTtXWIY8GKJ","name":"府中站"},{"_key":"-KeYwacCNUTtXWIY8GKK","name":"亞東醫院站"}],"name":"其他線a3","sort":3}],"name":"未命名(2)","sort":1,"key":"-KeYwacCNUTtXWIY8GKE"},{"line":[{"color":"#ff6900","metro":[{"_key":"-KeYwh_izITAvVo1M5nh","name":"台北車站"},{"_key":"-KeYwh_izITAvVo1M5ni","name":"關渡站"}],"name":"淡水線a1","sort":1},{"color":"#ff6900","metro":[{"_key":"-KeYwh_izITAvVo1M5nj","name":"府中站"},{"_key":"-KeYwh_izITAvVo1M5nk","name":"亞東醫院站"}],"name":"板南線a2","sort":2},{"color":"#ff6900","metro":[{"_key":"-KeYwh_izITAvVo1M5nl","name":"府中站"},{"_key":"-KeYwh_izITAvVo1M5nm","name":"亞東醫院站"}],"name":"其他線a3","sort":3}],"name":"未命名(3)","sort":1,"key":"-KeYwh_hYOLmZYO3mSrh"}]
  }
  $("#triangle_right").click(function(){
    $("#top_tag").css("left",(parseInt($("#top_tag").css("left"))-80));
  })
  $("#triangle_left").click(function(){
    var _x=parseInt($("#top_tag").css("left"))+80;
    if(_x>23)_x=23;
    $("#top_tag").css("left",_x);
  })
  
  $(function(){
    var el = document.getElementById("blueprint_drag");
    var sortable = Sortable.create(el);
  })
  
  
</script>
<script src="js/main.js"></script>
</body>
</html>