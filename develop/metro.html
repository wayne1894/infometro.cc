<!DOCTYPE html>
<html lang="zh-TW">
<head>
@@include('include/head.html')
</head>
<body>
<div id="main">
  <div id="left">
    <div id="line_parent">
      <div id="logo"><img src="images/icon_128.fw.png" alt=""></div>
      <div class="line_text">所有支線：</div>
      <div id="left_line">
        <ul id="line_drag">
          <li v-for="(item, index) in line" :class="check_line(index)">
            <div class="tool" @click="delete_line(index)">
              <i class="trash outline icon"></i>
            </div>
            <i class="line_i" style="background-color:#FF6907" ></i>
            <a  class="line_a" @click="change_line(index)">{{item.name}}</a>
            <input style="display:none;" type="text" v-model="item.name">
          </li>
        </ul>
      </div>
  		<a id="new_line" class="default_a" @click="new_line()">新增支線</a>
    </div>
    <div id="edit_parent">
      <a class="left_icon" href="javascript:void(0)"><i class="setting icon"></i></a>
      <a class="left_icon" href="javascript:void(0)"><i class="power icon"></i></a>
    </div>
  </div>
  <div id="top">
    <div id="triangle_left"></div>
    <div id="top_tag_parent">
      <ul id="top_tag">
        <li v-for="(item, index) in metro">
          <i style="background-color:none"></i><span>{{item.name}}</span>
        </li>
      </ul>
    </div>
    <div id="triangle_right"></div>
  </div>
  <div id="center">
    <div id="board1">
        <div id="board_line_parent">
          <div id="board_line"><i style="background-color:#30CB68"></i><div>淡水線</div></div>
          <div id="board_edit"><i class="male icon"></i></div>
        </div>
        <div id="board_tag_name">
          <div id="tag_name">
              <i style="background-color:#30CB68;"></i>
              <div id="tag_name_info">
                  <div>社會學</div>
                  <div>資訊共25筆</div>
                  <div>建立時間：<span>2015/03/29</span></div>
              </div>
          </div>
        </div>
      <div id="board3">
        <div id="board3_header"><i class="heart orange icon"></i><span class="text">最愛連結</span>
        </div>
        <div id="board_favorites">
          <div v-for="n in 20"></div>
        </div>
        <div id="board_search">
          <div id="input_search">
              <input type="text" placeholder="Search">
              <i class="search icon"></i>
          </div>
        </div>
        <div id="board_copyright"></div>
      </div>
    </div>
    <div id="board2">
      <div id="board_enter_parent">
        <div id="board_img"><img src="images/img1.jpg"></div>
        <div id="board_enter">
          <textarea id="board_textarea" name="textarea1" placeholder="輸入資訊"></textarea>
        </div>
      </div>
      <div id="board_send_parent">
        <div id="board_tag_select">
        </div>
        <button id="board_send" class="ui mini orange button" type="submit">送出</button>
      </div>
      <div id="board_info">
        <div v-for="(item, index) in info" class="ui vertical segment clear">
          <img class="ui medium left floated image transition " src="images/square-image.png">
          <p>看見我的靈魂裡那洗拭不去的黑色污點</p>
          <span class="left">
            <i class="like icon"></i>
            <i class="trash icon"></i>
          </span>
        </div>
      </div>
    </div>
  </div>
  <div id="bottom">
    <div id="blueprint">
      <div id="blueprint_drag">
        <div v-for="(item, index) in blueprint" class="blueprint_list ui top left pointing dropdown" >
          <a class="blueprint_a" :class="check_blueprint(index)"> {{item.name}}
          </a>
          <input type="text" v-model="item.name">
          <i class="dropdown icon"></i>
          <div class="menu">
            <div class="item" @click="change_blueprint_name(index)"><i class="edit icon"></i>修改名稱</div>
            <div class="item" @click="delete_blueprint(item)"><i class="delete icon"></i>移除</div>
            <div v-show="!check_blueprint(index)" class="item" @click="change_blueprint(index)"><i class="exchange icon"></i>切換</div>
          </div>
        </div>
      </div>
      <div id="blueprint_new" class="ui icon button" data-tooltip="新增一個地鐵計畫" data-inverted="" @click="new_blueprint()">
        <i class="add icon"></i>
      </div>
    </div>
    <div id="copyright">2017資訊地鐵站 版權所有 </div>
  </div>
  <div id="right">
    <div class="right_header_line"></div>
    <div class="right_tool">
      <div class="r_button">
        <div id="首頁" class="r_b t2"></div>
      </div>
      <div class="r_button active">
        <i class="facebook f icon"></i>
      </div>
      <div class="r_button">
        <div id="資訊" class="r_b t2"></div>
      </div>
      <div class="r_button">
        <div id="搜尋" class="r_b t2"></div>
      </div>
      <div class="r_button">
        <div id="問號" class="r_b t2"></div>
      </div>
    </div>
    <div class="right_main">
      <div v-for="n in 50">
        <br><br><br>
      </div>
    </div>
    <div class="right_line"></div>
  </div>
</div>
<script>
  var vm = new Vue({
    el: '#main',
    data: {
      blueprint : [],
      index_blueprint : 0,
      index_line : 0,
      key_metro : ""
    },firebase: function(){
      var _user = user ? user.uid : "" ;
      var _key_metro = this.key_metro.length ? this.key_metro : "N";//用N的用意是避免載入所有結點
      return {
        info: D.ref("info/"+_user+"/"+_key_metro)
      }
    },computed: {
     line : function(){//載入line
       if(this.blueprint.length==0)return false;
       return this.blueprint[this.index_blueprint].line;
     },
     metro : function(){//載入metro
       if(this.blueprint.length==0)return false; //藍圖如果不存在離開
       var _line=this.blueprint[this.index_blueprint].line
       if(_line.length==0)return false; //線如果不存在離開
       this.key_metro = _line[this.index_line].metro[0]._key; //載入時直接選取一個站點(可以是該線路的總站)
       return _line[this.index_line].metro;
     }
    },watch: {
      key_metro : function (){//載入新的info
        vm.$bindAsObject('info', D.ref("info/"+user.uid+"/"+this.key_metro));
      }
    },methods: {
      new_blueprint : function(){//新增藍圖
        新增藍圖("未命名");
      },delete_blueprint : function (item){//刪除藍圖
		刪除藍圖(item.key);
      },change_blueprint : function(index){
        this.index_blueprint=index;
      },change_blueprint_name : function(index){
      var _a=$(event.target).closest(".blueprint_list")   
        _a.find(".blueprint_a").hide();
        _a.find("i").hide();
        _a.find("input").show();
        sortable1.option("disabled", true);
      },check_blueprint : function(index){
        if(this.index_blueprint==index){
          return "check";
        }
      },change_line : function(index){
        this.index_line=index;
      },get_blueprint : function(){
		return this.blueprint[this.index_blueprint];
      },check_line : function(index){
        if(this.index_line==index){
          return "check";
        }
      },new_line : function(){
        var _j=line_json("未命名","#B3B3B3");
        _j.metro.push(metro_json("總站"));
        var data=this.get_blueprint();
        data.line.push(_j);
        更新藍圖(data.key,data);
      },delete_line : function(index){
        var data=this.get_blueprint();
        data.line.splice(index,1);
        更新藍圖(data.key,data);
      },new_metro : function (order){
        if(order==undefined)order=0;
        var _m=metro_json("未命名");
        var data=this.get_blueprint();
        data.line[this.index_line].metro.splice(order,0,_m)
        更新藍圖(data.key,data);
      }
    }
  })

  function _is_login(){//程式入口
    blueprint_init(function(){
      $(".blueprint_list").dropdown("destroy").dropdown({
         on : 'customClick'
       }).unbind("click").click(function(event){
        if(event.target.nodeName=="INPUT"){
          return
        }
        $(this).trigger("customClick");
      })
    });
  }

  $("#triangle_right").click(function(){
    $("#top_tag").css("left",(parseInt($("#top_tag").css("left"))-80));
  })
  $("#triangle_left").click(function(){
    var _x=parseInt($("#top_tag").css("left"))+80;
    if(_x>23)_x=23;
    $("#top_tag").css("left",_x);
  })
    var sortable1 =new Sortable($("#blueprint_drag")[0]);
    var sortable2 =new Sortable($("#line_drag")[0]);    
</script>

<script src="js/main.js"></script>
</body>
</html>